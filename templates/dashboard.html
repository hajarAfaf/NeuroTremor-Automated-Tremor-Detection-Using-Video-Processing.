{% extends "base.html" %}
{% block title %}Dashboard Médecin{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-10">
  <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-10 text-center leading-tight">Bienvenue, Dr. <span class="text-blue-700">{{ current_user.username }}</span></h2>

  <div class="bg-white p-10 rounded-xl shadow-xl border border-gray-100 mb-10">
    <h3 class="text-3xl font-bold text-gray-800 mb-6">Vos Patients Assignés</h3>
    
    {% if patients %}
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            {% set next_order_username = 'desc' if sort_info.by == 'username' and sort_info.order == 'asc' else 'asc' %}
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
              <a href="{{ url_for('main.dashboard', sort_by='username', order=next_order_username) }}" class="flex items-center space-x-1 hover:text-blue-700 transition duration-300">
                <span>Nom du Patient</span>
                {% if sort_info.by == 'username' %}
                  <i class="fas fa-arrow-{{ 'down' if sort_info.order == 'asc' else 'up' }} ml-1"></i>
                {% endif %}
              </a>
            </th>

            {% set next_order_age = 'desc' if sort_info.by == 'age' and sort_info.order == 'asc' else 'asc' %}
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
              <a href="{{ url_for('main.dashboard', sort_by='age', order=next_order_age) }}" class="flex items-center space-x-1 hover:text-blue-700 transition duration-300">
                <span>Âge</span>
                {% if sort_info.by == 'age' %}
                  <i class="fas fa-arrow-{{ 'down' if sort_info.order == 'asc' else 'up' }} ml-1"></i>
                {% endif %}
              </a>
            </th>

            {% set next_order_severity = 'desc' if sort_info.by == 'severity' and sort_info.order == 'asc' else 'asc' %}
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
              <a href="{{ url_for('main.dashboard', sort_by='severity', order=next_order_severity) }}" class="flex items-center space-x-1 hover:text-blue-700 transition duration-300">
                <span>Dernière Sévérité</span>
                {% if sort_info.by == 'severity' %}
                  <i class="fas fa-arrow-{{ 'down' if sort_info.order == 'asc' else 'up' }} ml-1"></i>
                {% endif %}
              </a>
            </th>
            
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for patient in patients %}
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-base font-medium text-gray-900">{{ patient.username }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-base text-gray-800">{{ patient.age if patient.age is not none else 'N/A' }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-base text-gray-800">
              {% if patient.latest_severity != 'N/A' %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                  {% if patient.latest_severity == 'Sévère' %} bg-red-100 text-red-800
                  {% elif patient.latest_severity == 'Modéré' %} bg-yellow-100 text-yellow-800
                  {% elif patient.latest_severity == 'Léger' %} bg-green-100 text-green-800
                  {% else %} bg-blue-100 text-blue-800
                  {% endif %}">
                  {{ patient.latest_severity }}
                </span>
              {% else %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Aucune analyse</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-base font-medium">
              <a href="{{ url_for('main.patient_history', patient_id=patient._id) }}" class="text-blue-600 hover:text-blue-800 transition duration-300 ease-in-out">Voir l'historique</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="bg-blue-100 border border-blue-400 text-blue-700 px-6 py-4 rounded-xl shadow-md" role="alert">
      <p class="text-lg">Aucun patient ne vous a été assigné pour le moment.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
